<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üê≠‚ú® –ñ–∏–≤—ã–µ –∫—Ä—ã—Å—ã - RCD Fancy Room 1</title>

  <!-- üê≠ –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫—Ä—ã—Å–∏–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="rat_3d_effects.css">

  <!-- üö® –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

  <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å -->
  <script>
    console.log('THREE –∑–∞–≥—Ä—É–∂–µ–Ω:', typeof THREE !== 'undefined');
    console.log('Matter –∑–∞–≥—Ä—É–∂–µ–Ω:', typeof Matter !== 'undefined');
    if (typeof THREE === 'undefined') {
      alert('THREE.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è!');
    }
    if (typeof Matter === 'undefined') {
      alert('Matter.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è!');
    } else {
      console.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º Matter.js –≤–º–µ—Å—Ç–æ Cannon.js');
    }
  </script>
</head>
<body>
<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ -->
<nav class="room-navigation">
  <a href="../dog_living_room.html" class="back-button">
    <span>üõãÔ∏è</span>
    <span>–≠—Ç–∞–∂ —á—É–¥–µ—Å</span>
  </a>
  <a href="../../dog_rcd_rat_house.html" class="home-button">
    <span>üè†</span>
    <span>–î–æ–º–æ–π</span>
  </a>
</nav>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–º–Ω–∞—Ç—ã -->
<div class="room-container" id="room-container">

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–º–Ω–∞—Ç—ã -->
  <header class="room-header">
    <h1 class="room-title">üê≠‚ú® –ñ–∏–≤—ã–µ –∫—Ä—ã—Å—ã</h1>
    <p class="room-subtitle">3D –∫—Ä—ã—Å—ã –±–µ–≥–∞—é—Ç –∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –≤–∞—à –∫—É—Ä—Å–æ—Ä</p>
  </header>

  <!-- 3D –°—Ü–µ–Ω–∞ -->
  <main class="scene-container">
    <canvas id="three-canvas" class="main-canvas"></canvas>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p class="loading-text">–ö—Ä—ã—Å—ã –ø—Ä–æ—Å—ã–ø–∞—é—Ç—Å—è...</p>
      </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –æ—à–∏–±–∫–∏ -->
    <div class="error-overlay" id="error-overlay" style="display: none;">
      <div class="error-content">
        <h2>üòø –£–ø—Å!</h2>
        <p class="error-message">–ö—Ä—ã—Å—ã —Ä–∞–∑–±–µ–∂–∞–ª–∏—Å—å...</p>
        <button class="retry-button" id="retry-button">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
      </div>
    </div>
  </main>

  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <aside class="control-panel">
    <div class="panel-section">
      <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
      <div class="control-group">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—ã—Å:</label>
        <input type="range" id="rat-count" min="1" max="7" value="3" class="control-slider">
        <span id="rat-count-value">3</span>
      </div>
      <div class="control-group">
        <label>–°–∫–æ—Ä–æ—Å—Ç—å:</label>
        <input type="range" id="rat-speed" min="0.1" max="3" step="0.1" value="1" class="control-slider">
        <span id="rat-speed-value">1.0</span>
      </div>
      <div class="control-group">
        <button id="pause-button" class="control-button">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
        <button id="reset-button" class="control-button">üîÑ –°–±—Ä–æ—Å</button>
      </div>
    </div>

    <div class="panel-section">
      <h3>‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
      <div class="stats-display">
        <div class="stat-item">
          <span class="stat-label">FPS:</span>
          <span id="fps-counter" class="stat-value">60</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–ö—Ä—ã—Å:</span>
          <span id="active-rats" class="stat-value">3</span>
        </div>
      </div>
      <button id="emergency-stop" class="emergency-button">üö® –°–¢–û–ü</button>
      <div class="performance-warning" id="performance-warning" style="display: none;">
        ‚ö†Ô∏è –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å!
      </div>
    </div>

    <div class="panel-section">
      <h3>üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
      <div class="control-group">
        <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞:</label>
        <input type="color" id="background-color" value="#1a1a2e" class="color-picker">
      </div>
      <div class="control-group">
        <label>–û—Å–≤–µ—â–µ–Ω–∏–µ:</label>
        <input type="range" id="light-intensity" min="0.1" max="2" step="0.1" value="0.8" class="control-slider">
        <span id="light-value">0.8</span>
      </div>
    </div>
  </aside>

  <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
  <div class="instructions" id="instructions">
    <h4>üìã –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h4>
    <ul>
      <li>üñ±Ô∏è –î–≤–∏–≥–∞–π—Ç–µ –º—ã—à–∫–æ–π - –∫—Ä—ã—Å—ã –±—É–¥—É—Ç —É–±–µ–≥–∞—Ç—å</li>
      <li>üñ±Ô∏è –î–µ—Ä–∂–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ - –∫—Ä—ã—Å—ã —Å—Ç–∞–Ω—É—Ç –ª—é–±–æ–ø—ã—Ç–Ω—ã–º–∏</li>
      <li>üì± –ù–∞ —Ç–∞—á—Å–∫—Ä–∏–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Å–∞–Ω–∏—è</li>
      <li>üéÆ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—ã—Å</li>
      <li>‚ö†Ô∏è –ü—Ä–∏ –ª–∞–≥–∞—Ö –Ω–∞–∂–º–∏—Ç–µ "–°–¢–û–ü"</li>
    </ul>
    <button class="close-instructions" onclick="this.parentElement.style.display='none'">
      ‚úï –ó–∞–∫—Ä—ã—Ç—å
    </button>
  </div>
</div>

<!-- üê± –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ—Ç–æ–≤-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ -->
<script src="cat_three_controller.js"></script>
<script src="cat_physics_controller.js"></script>
<script src="cat_interaction_controller.js"></script>

<!-- üê± –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä -->
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      console.log('üê≠ –ö–æ–º–Ω–∞—Ç–∞ –∂–∏–≤—ã—Ö –∫—Ä—ã—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É WebGL
      if (!window.WebGLRenderingContext) {
        throw new Error('WebGL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ—Ç–æ–≤-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
      await window.ThreeController.initialize();
      await window.PhysicsController.initialize();
      await window.InteractionController.initialize();

      console.log('üéâ –ö–æ–º–Ω–∞—Ç–∞ –≥–æ—Ç–æ–≤–∞! –ö—Ä—ã—Å—ã –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å!');

    } catch (error) {
      console.error('üí• –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–Ω–∞—Ç—ã:', error);
      document.getElementById('error-overlay').style.display = 'flex';
      document.querySelector('.error-message').textContent = error.message;
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–≤—Ç–æ—Ä–∞
  document.getElementById('retry-button').addEventListener('click', () => {
    window.location.reload();
  });
</script>
</body>
</html>