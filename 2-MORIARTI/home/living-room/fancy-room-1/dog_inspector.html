<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 Тест библиотек</title>
</head>
<body>
<h1>🧪 Тест загрузки библиотек</h1>
<div id="results"></div>

<!-- Тестируем АЛЬТЕРНАТИВЫ Cannon.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
    // Пробуем альтернативные физические движки
    const physicsUrls = [
        {
            name: 'Ammo.js (Bullet Physics)',
            url: 'https://cdnjs.cloudflare.com/ajax/libs/ammo.js/0.0.10/ammo.min.js',
            test: () => typeof Ammo !== 'undefined'
        },
        {
            name: 'Matter.js (2D физика)',
            url: 'https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js',
            test: () => typeof Matter !== 'undefined'
        },
        {
            name: 'Rapier.js (Rust физика)',
            url: 'https://cdn.skypack.dev/@dimforge/rapier3d',
            test: () => typeof RAPIER !== 'undefined'
        },
        {
            name: 'Box2D.js',
            url: 'https://cdnjs.cloudflare.com/ajax/libs/box2d/1.0.2/box2d.min.js',
            test: () => typeof Box2D !== 'undefined'
        },
        {
            name: 'CANNON-ES (новый Cannon)',
            url: 'https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.min.js',
            test: () => typeof CANNON !== 'undefined'
        }
    ];

    let currentIndex = 0;

    function tryNextPhysics() {
        if (currentIndex >= physicsUrls.length) {
            addResult('💀 Все физические движки недоступны!', false);
            addResult('🤔 Может быть, сделаем крыс без физики?', false);
            return;
        }

        const lib = physicsUrls[currentIndex];
        addResult(`🔄 Пробуем ${lib.name}...`);

        const script = document.createElement('script');
        script.src = lib.url;

        script.onload = () => {
            setTimeout(() => {
                if (lib.test()) {
                    addResult(`✅ ${lib.name} РАБОТАЕТ!`);
                    addResult(`🎉 МОЖНО ИСПОЛЬЗОВАТЬ: ${lib.url}`);

                    // Пробуем создать физический мир
                    try {
                        if (lib.name.includes('Matter')) {
                            const engine = Matter.Engine.create();
                            addResult('✅ Matter.Engine создан успешно!');
                        } else if (lib.name.includes('CANNON-ES')) {
                            const world = new CANNON.World();
                            addResult('✅ CANNON-ES World создан успешно!');
                        }
                    } catch (error) {
                        addResult(`❌ Ошибка создания: ${error.message}`, false);
                    }
                } else {
                    addResult(`❌ ${lib.name} не загрузился`, false);
                    currentIndex++;
                    setTimeout(() => tryNextPhysics(), 100);
                }
            }, 200);
        };

        script.onerror = () => {
            addResult(`❌ ${lib.name} недоступен`, false);
            currentIndex++;
            setTimeout(() => tryNextPhysics(), 100);
        };

        document.head.appendChild(script);
    }

    // Запускаем поиск альтернатив
    setTimeout(() => tryNextPhysics(), 1000);
</script>

<script>
    const results = document.getElementById('results');

    function addResult(message, isSuccess = true) {
        const div = document.createElement('div');
        div.style.color = isSuccess ? 'green' : 'red';
        div.style.margin = '10px 0';
        div.textContent = message;
        results.appendChild(div);
    }

    // Проверяем загрузку
    setTimeout(() => {
        console.log('THREE type:', typeof THREE);
        console.log('CANNON type:', typeof CANNON);

        if (typeof THREE !== 'undefined') {
            addResult('✅ THREE.js загружен успешно!');
            addResult(`   Версия: ${THREE.REVISION}`);
        } else {
            addResult('❌ THREE.js НЕ загружен!', false);
        }

        if (typeof CANNON !== 'undefined') {
            addResult('✅ CANNON.js загружен успешно!');
            addResult(`   Версия: ${CANNON.version || 'неизвестна'}`);
        } else {
            addResult('❌ CANNON.js НЕ загружен!', false);
        }

        // Тестируем создание объектов
        try {
            if (typeof THREE !== 'undefined') {
                const scene = new THREE.Scene();
                addResult('✅ THREE.Scene создана успешно!');
            }

            if (typeof CANNON !== 'undefined') {
                const world = new CANNON.World();
                addResult('✅ CANNON.World создан успешно!');
            }
        } catch (error) {
            addResult(`❌ Ошибка создания объектов: ${error.message}`, false);
        }

    }, 1000);

    // Обработчик ошибок
    window.addEventListener('error', (e) => {
        addResult(`❌ Ошибка загрузки: ${e.message}`, false);
        console.error('Loading error:', e);
    });

    document.addEventListener('DOMContentLoaded', () => {
        addResult('📄 DOM загружен');
    });
</script>
</body>
</html>